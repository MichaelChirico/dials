<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Working with Tuning Parameters</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 800px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 20px;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 0;
padding: 4px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table:not([class]) {
margin: auto;
min-width: 40%;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table[summary="R argblock"] {
width: 100%;
border: none;
}
table:not([class]) th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table:not([class]) td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table:not([class]), table:not([class]) th, table:not([class]) td {
border-left-style: none;
border-right-style: none;
}
table:not([class]) tr.odd {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 13px;
padding-bottom: 1px;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f5f5f5;
border-radius: 3px;
color: #333;
}
pre {
overflow-x: auto;
border-radius: 3px;
margin: 5px 0 10px 0;
padding: 10px;
}
pre:not([class]) {
background-color: white;
border: #f5f5f5 1px solid;
}
pre:not([class]) code {
color: #444;
background-color: white;
}
code {
font-family: monospace;
font-size: 90%;
}
p > code, li > code {
padding: 2px 4px;
color: #d14;
border: 1px solid #e1e1e8;
white-space: inherit;
}
div.figure {
text-align: center;
}
table > caption, div.figure p.caption {
font-style: italic;
}
table > caption span, div.figure p.caption span {
font-style: normal;
font-weight: bold;
}
p {
margin: 0 0 10px;
}
table:not([class]) {
margin: auto auto 10px auto;
}
img:not([class]) {
background-color: #FFFFFF;
padding: 2px;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
max-width: 100%;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f5f5f5;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f5f5f5;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f5f5f5;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }
div.r-help-page {
background-color: #f9f9f9;
border-bottom: #ddd 1px solid;
margin-bottom: 10px;
padding: 10px;
}
div.r-help-page:hover {
background-color: #f4f4f4;
}

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">Working with Tuning Parameters</h1>


<div id="TOC">
<ul>
<li><a href="#tuning-parameters">Tuning Parameters</a></li>
<li><a href="#param-objects"><code>param</code> Objects</a></li>
<li><a href="#numeric-parameters">Numeric Parameters</a></li>
<li><a href="#discrete-parameters">Discrete Parameters</a></li>
<li><a href="#unknown-values">Unknown Values</a></li>
<li><a href="#parameter-grids">Parameter Grids</a></li>
</ul>
</div>

<div id="tuning-parameters" class="section level1">
<h1>Tuning Parameters</h1>
<p>Some statistical and machine learning models contain <em>tuning parameters</em> (also known as <em>hyperparameters</em>), which are parameters that cannot be directly estimated by the model. An example would be the number of neighbors in a <em>K</em>-nearest neighbors model. To determine reasonable values of these elements, some indirect method is used such as resampling or profile likelihood. Search methods, such as genetic algorithms or Bayesian search can also be used to <a href="https://github.com/topepo/Optimization-Methods-for-Tuning-Predictive-Models">determine good values</a>.</p>
<p>In any case, some information is needed to create a grid or to validate whether a candidate value is appropriate (i.e. neighbors should be a positive integer). <code>dials</code> is designed to:</p>
<ul>
<li>Create an easy to use framework for describing and querying tuning parameters. this can include getting sequences or random tuning values, validating current values, transforming parameters, and other tasks.</li>
<li>Standardize the names of different parameters. Different packages in R use different argument names for the same quantities. <code>dials</code> proposes some standardized names so that the user doesn’t need to memorize the syntactical minutiae of every package.</li>
<li>Work with the <a href="https://topepo.github.io/parsnip/"><code>parsnip</code></a> package which is a modern attempt to standardize the interfaces for specific models across R packages and computational engines.</li>
<li>Adhere to <a href="https://cran.r-project.org/web/packages/tidyverse/vignettes/manifesto.html">tidy principals</a>.</li>
</ul>
<p>The main type of objects in <code>dials</code> have class <code>param</code>.</p>
<p>change <code>units</code> to <code>hidden_units</code> and <code>weight_decay</code> to <code>regularization</code></p>
</div>
<div id="param-objects" class="section level1">
<h1><code>param</code> Objects</h1>
<p><code>param</code> objects contain information about possible values, ranges, types, and other aspects. There are two main subclasses related to the type of variable. Double and integer valued data have the subclass “quant_param” while character and logicals have “qual_param.” There are some common elements for each:</p>
<ul>
<li>Labels are strings that describe the parameter (e.g. “Number of Components”)</li>
<li>Defaults are optional single values that can be set when one non-random value is requested.</li>
</ul>
<p>Otherwise, the information contained in <code>param</code> objects are different for different data types.</p>
</div>
<div id="numeric-parameters" class="section level1">
<h1>Numeric Parameters</h1>
<p>An example of a numeric tuning parameter is the cost-complexity parameter of CART trees, other wise known as <span class="math inline">\(C_p\)</span>. The parameter object in <code>dials</code> is:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(dials)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">Cp</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt; Cost-Complexity Parameter  (quantitative)</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; Transformer:  log-10 </span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; Range (transformed scale): [-10, -1]</span></a></code></pre></div>
<p>Note that this parameter is handled in log units and the default range of values is between `10^-10$ and 0.1. The range of possible values can be returned and changed based on some utility functions. We’ll use the pipe operator here:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(tidymodels)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt; Warning: 'DESCRIPTION' file has an 'Encoding' field and re-encoding is not</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt; possible</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">Cp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">range_get</span>()</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; $lower</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; [1] 1e-10</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; $upper</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt; [1] 0.1</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">Cp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">range_set</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt; Quantitative Parameter</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt; Transformer:  log-10 </span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt; Range (transformed scale): [-5, 1]</span></a></code></pre></div>
<p>Values for this parameter can be obtained in a few different ways. To get a sequence of values that span the range:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Natural units:</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">Cp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">value_seq</span>(<span class="dt">n =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; [1] 1e-10 1e-07 1e-04 1e-01</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co"># Stay in the transformed space:</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">Cp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">value_seq</span>(<span class="dt">n =</span> <span class="dv">4</span>, <span class="dt">original =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; [1] -10  -7  -4  -1</span></a></code></pre></div>
<p>Random values can be sampled too. A random uniform distribution is used (between the range values). Since this parameter has a transformation associated with it, the values are simulated in the transformed scale and then returned in the natural units (although another <code>original</code> argument can be used here):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">5473</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">Cp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">value_sample</span>(<span class="dt">n =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; [1] 6.91e-09 8.46e-04 3.45e-06 5.90e-10</span></a></code></pre></div>
<p>For CART trees, there is a discrete set of values that exist for a given data set. It may be a good idea to assign these possible values to the object. We can get them by fitting an initial <code>rpart</code> model and then adding the values to the object. For <code>mtcars</code>, there are only three values:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">library</span>(rpart)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">cart_mod &lt;-<span class="st"> </span><span class="kw">rpart</span>(mpg <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> mtcars, <span class="dt">control =</span> <span class="kw">rpart.control</span>(<span class="dt">cp =</span> <span class="fl">0.000001</span>))</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">cart_mod<span class="op">$</span>cptable</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt;         CP nsplit rel error xerror  xstd</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; 1 0.643125      0     1.000  1.083 0.259</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt; 2 0.097484      1     0.357  0.669 0.168</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt; 3 0.000001      2     0.259  0.574 0.125</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8">cp_vals &lt;-<span class="st"> </span>cart_mod<span class="op">$</span>cptable[, <span class="st">&quot;CP&quot;</span>]</a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co"># Ww should only keep values associated with at least one split:</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10">cp_vals &lt;-<span class="st"> </span>cp_vals[ cart_mod<span class="op">$</span>cptable[, <span class="st">&quot;nsplit&quot;</span>] <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> ]</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">mtcars_cp &lt;-<span class="st"> </span>Cp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">value_set</span>(cp_vals)</a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt; Error in new_quant_param(type = object$type, range = object$range, inclusive = object$inclusive, : Some values are not valid: 0.09748...</span></a></code></pre></div>
<p>The error occurs because the values are not in the transformed scale:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">mtcars_cp &lt;-<span class="st"> </span>Cp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">value_set</span>(<span class="kw">log10</span>(cp_vals))</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">mtcars_cp</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; Quantitative Parameter</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; Transformer:  log-10 </span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; Range (transformed scale): [-10, -1]</span></a></code></pre></div>
<p>Now, if we want a sequence or random sample, it uses the set values:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">mtcars_cp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">value_seq</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; [1] 1e-10 1e-01</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co"># Sampling specific values is done with replacement</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">mtcars_cp <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="st">  </span><span class="kw">value_sample</span>(<span class="dv">20</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="st">  </span><span class="kw">table</span>()</a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; .</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt; 1.22553673948722e-10  1.9491069184926e-10 2.06459516092319e-10 </span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;                    1                    1                    1 </span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt; 3.75951178494343e-10 6.62836055102585e-10  5.0411261119624e-09 </span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt;                    1                    1                    1 </span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt;  5.4985043737208e-08 5.83931461007239e-08 1.09866284725065e-07 </span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt;                    1                    1                    1 </span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt; 5.10496763244684e-07 5.54353480732395e-07 1.10030352245288e-06 </span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt;                    1                    1                    1 </span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt; 5.10317458890359e-06  3.0361613047094e-05  0.00017933103772325 </span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#&gt;                    1                    1                    1 </span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co">#&gt; 0.000284004049247611  0.00125689270729615  0.00189905048136124 </span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="co">#&gt;                    1                    1                    1 </span></a>
<a class="sourceLine" id="cb7-20" data-line-number="20"><span class="co">#&gt;  0.00637318264066997   0.0195092949398018 </span></a>
<a class="sourceLine" id="cb7-21" data-line-number="21"><span class="co">#&gt;                    1                    1</span></a></code></pre></div>
</div>
<div id="discrete-parameters" class="section level1">
<h1>Discrete Parameters</h1>
</div>
<div id="unknown-values" class="section level1">
<h1>Unknown Values</h1>
</div>
<div id="parameter-grids" class="section level1">
<h1>Parameter Grids</h1>
</div>

<script type="text/javascript">
window.onload = function() {
  var i, fig = 1, caps = document.getElementsByClassName('caption');
  for (i = 0; i < caps.length; i++) {
    var cap = caps[i];
    if (cap.parentElement.className !== 'figure' || cap.nodeName !== 'P')
      continue;
    cap.innerHTML = '<span>Figure ' + fig + ':</span> ' + cap.innerHTML;
    fig++;
  }
  fig = 1;
  caps = document.getElementsByTagName('caption');
  for (i = 0; i < caps.length; i++) {
    var cap = caps[i];
    if (cap.parentElement.nodeName !== 'TABLE') continue;
    cap.innerHTML = '<span>Table ' + fig + ':</span> ' + cap.innerHTML;
    fig++;
  }
}
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
